class Level extends Phaser.Scene{constructor(){super("Level"),this.player,this.platforms,this.cursors,this.playerSpeed=window.gameOpt.playerSpeed,this.bombs,this.frameTime=0,this.spawnTime=1e3*window.gameOpt.spawnTime,this.gravityY=window.gameOpt.gravity,this.score=0,this.gameOver=!1}editorCreate(){const e=this.add.text(264,59,"",{});e.setOrigin(.5,.5),e.text="Score : 0",e.setStyle({fontFamily:"Arial",fontSize:"30px"}),this.add.image(360,640,"bg");const t=this.add.text(496,59,"",{});t.setOrigin(.5,.5),t.text="Time : 00:00",t.setStyle({fontFamily:"Arial",fontSize:"30px"}),this.scoreTxt=e,this.timeTxt=t,this.events.emit("scene-awake")}scoreTxt;timeTxt;create(){this.editorCreate(),this.scoreTxt.setDepth(1),this.timeTxt.setDepth(1),this.platforms=this.physics.add.staticGroup(),this.platforms.create(360,1220,"ground").setScale(2).setAlpha(0).refreshBody(),this.player=this.physics.add.sprite(360,1140,"player"),this.player.setBounce(.2),this.player.body.setCollideWorldBounds(!0),this.player.body.setCircle(30,28,10),this.anims.create({key:"left",frames:this.anims.generateFrameNumbers("player",{start:0,end:2}),frameRate:10,repeat:-1}),this.anims.create({key:"turn",frames:[{key:"player",frame:3}],frameRate:20}),this.anims.create({key:"fail",frames:[{key:"player",frame:7}],frameRate:20}),this.anims.create({key:"right",frames:this.anims.generateFrameNumbers("player",{start:4,end:6}),frameRate:10,repeat:-1}),this.physics.add.collider(this.player,this.platforms),this.cursors=this.input.keyboard.createCursorKeys(),this.bombs=this.physics.add.group(),this.physics.add.collider(this.bombs,this.platforms,this.hitPlatform,null,this),this.physics.add.collider(this.player,this.bombs,this.hitBomb,null,this)}update(e,t){if(!this.gameOver){if(this.timeTxt.setText(`Time : ${new Date(1e3*Math.round(.001*e)).toISOString().slice(14,19)}`),this.frameTime+=t,this.frameTime>this.spawnTime){this.frameTime=0;const e=this.bombs.create(Phaser.Math.Between(0,720),-100,"bomb");e.body.setCollideWorldBounds(!0),e.body.setCircle(23,35,48),e.setGravityY(this.gravityY)}this.sys.game.device.os.desktop?this.cursors.left.isDown?(this.player.setVelocityX(-this.playerSpeed),this.player.anims.play("left",!0)):this.cursors.right.isDown?(this.player.setVelocityX(this.playerSpeed),this.player.anims.play("right",!0)):(this.player.setVelocityX(0),this.player.anims.play("turn")):this.input.activePointer.isDown?this.input.activePointer.x<this.player.x?(this.player.setVelocityX(-this.playerSpeed),this.player.anims.play("left",!0)):(this.player.setVelocityX(this.playerSpeed),this.player.anims.play("right",!0)):(this.player.setVelocityX(0),this.player.anims.play("turn"))}}hitBomb(e,t){this.physics.pause(),e.anims.play("fail"),this.gameOver=!0,$.ajax({url:`${apiUrl}/api/poo`,data:{serialNum:window.serialNum,score:parseInt(this.scoreTxt),playTime:parseInt(this.timeTxt),publishedDate:new Date},dataType:"json",method:"post",success:function(e){console.log(e)},error:function(e,t,s){console.error(`[API ERROR] => ${e.responseText}`)}})}hitPlatform(e,t){e.disableBody(!0,!1),e.setTexture("bombEffect"),this.tweens.add({targets:e,duration:500,alpha:{from:1,to:0},onComplete:()=>{e.disableBody(!0,!0)}}),this.score+=window.gameOpt.score,this.scoreTxt.setText(`Score : ${this.score}`)}}